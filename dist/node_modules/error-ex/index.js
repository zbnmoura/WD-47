"use strict";var util=require("util"),isArrayish=require("is-arrayish"),errorEx=function(r,e){r&&r.constructor===String||(e=r||{},r=Error.name);var t=function i(n){if(!this)return new i(n);n=n instanceof Error?n.message:n||this.message,Error.call(this,n),Error.captureStackTrace(this,t),this.name=r,Object.defineProperty(this,"message",{configurable:!0,enumerable:!1,get:function(){var r=n.split(/\r?\n/g);for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];"message"in i&&(r=i.message(this[t],r)||r,isArrayish(r)||(r=[r]))}return r.join("\n")},set:function(r){n=r}});var s=Object.getOwnPropertyDescriptor(this,"stack"),o=s.get,a=s.value;delete s.value,delete s.writable,s.get=function(){var r=o?o.call(this).split(/\r?\n+/g):a.split(/\r?\n+/g);r[0]=this.name+": "+this.message;var t=1;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if("line"in n){var s=n.line(this[i]);s&&r.splice(t++,0,"    "+s)}"stack"in n&&n.stack(this[i],r)}return r.join("\n")},Object.defineProperty(this,"stack",s)};return Object.setPrototypeOf?(Object.setPrototypeOf(t.prototype,Error.prototype),Object.setPrototypeOf(t,Error)):util.inherits(t,Error),t};errorEx.append=function(r,e){return{message:function(t,i){return(t=t||e)&&(i[0]+=" "+r.replace("%s",t.toString())),i}}},errorEx.line=function(r,e){return{line:function(t){return(t=t||e)?r.replace("%s",t.toString()):null}}},module.exports=errorEx;