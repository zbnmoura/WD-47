"use strict";var concatMap=require("concat-map"),balanced=require("balanced-match");module.exports=expandTop;var escSlash="\0SLASH"+Math.random()+"\0",escOpen="\0OPEN"+Math.random()+"\0",escClose="\0CLOSE"+Math.random()+"\0",escComma="\0COMMA"+Math.random()+"\0",escPeriod="\0PERIOD"+Math.random()+"\0";function numeric(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function escapeBraces(e){return e.split("\\\\").join(escSlash).split("\\{").join(escOpen).split("\\}").join(escClose).split("\\,").join(escComma).split("\\.").join(escPeriod)}function unescapeBraces(e){return e.split(escSlash).join("\\").split(escOpen).join("{").split(escClose).join("}").split(escComma).join(",").split(escPeriod).join(".")}function parseCommaParts(e){if(!e)return[""];var n=[],t=balanced("{","}",e);if(!t)return e.split(",");var r=t.pre,a=t.body,s=t.post,o=r.split(",");o[o.length-1]+="{"+a+"}";var i=parseCommaParts(s);return s.length&&(o[o.length-1]+=i.shift(),o.push.apply(o,i)),n.push.apply(n,o),n}function expandTop(e){return e?("{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2)),expand(escapeBraces(e),!0).map(unescapeBraces)):[]}function identity(e){return e}function embrace(e){return"{"+e+"}"}function isPadded(e){return/^-?0\d/.test(e)}function lte(e,n){return e<=n}function gte(e,n){return e>=n}function expand(e,n){var t=[],r=balanced("{","}",e);if(!r||/\$$/.test(r.pre))return[e];var a,s=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),i=s||o,p=r.body.indexOf(",")>=0;if(!i&&!p)return r.post.match(/,.*\}/)?expand(e=r.pre+"{"+r.body+escClose+r.post):[e];if(i)a=r.body.split(/\.\./);else if(1===(a=parseCommaParts(r.body)).length&&1===(a=expand(a[0],!1).map(embrace)).length)return(l=r.post.length?expand(r.post,!1):[""]).map(function(e){return r.pre+a[0]+e});var c,u=r.pre,l=r.post.length?expand(r.post,!1):[""];if(i){var d=numeric(a[0]),m=numeric(a[1]),h=Math.max(a[0].length,a[1].length),f=3==a.length?Math.abs(numeric(a[2])):1,g=lte;m<d&&(f*=-1,g=gte);var v=a.some(isPadded);c=[];for(var b=d;g(b,m);b+=f){var C;if(o)"\\"===(C=String.fromCharCode(b))&&(C="");else if(C=String(b),v){var x=h-C.length;if(x>0){var j=new Array(x+1).join("0");C=b<0?"-"+j+C.slice(1):j+C}}c.push(C)}}else c=concatMap(a,function(e){return expand(e,!1)});for(var y=0;y<c.length;y++)for(var M=0;M<l.length;M++){var P=u+c[y]+l[M];(!n||i||P)&&t.push(P)}return t}