"use strict";var tfunk=require("tfunk"),_=require("./lodash.custom"),defaults={level:"info",prefix:"",levels:{trace:100,debug:200,warn:300,info:400,error:500},prefixes:{trace:"[trace] ",debug:"{yellow:[debug]} ",info:"{cyan:[info]} ",warn:"{magenta:[warn]} ",error:"{red:[error]} "},useLevelPrefixes:!1},Logger=function e(t){return this instanceof e?(t=t||{},this._mute=!1,this.config=_.merge({},defaults,t),this.addLevelMethods(this.config.levels),this.compiler=new tfunk.Compiler(this.config.custom||{},this.config),this._memo={},this):new e(t)};Logger.prototype.setOnce=function(e,t){return void 0!==this.config[e]&&(void 0===this._memo[e]&&(this._memo[e]=this.config[e]),this.config[e]=t),this},Logger.prototype.addLevelMethods=function(e){Object.keys(e).forEach(function(e){this[e]||(this[e]=function(){var e=Array.prototype.slice.call(arguments);return this.log.apply(this,e),this}.bind(this,e))},this)},Logger.prototype.reset=function(){return this.setLevel(defaults.level).setLevelPrefixes(defaults.useLevelPrefixes).mute(!1),this},Logger.prototype.canLog=function(e){return this.config.levels[e]>=this.config.levels[this.config.level]&&!this._mute},Logger.prototype.log=function(e,t){var o=Array.prototype.slice.call(arguments);return this.logOne(o,t,e),this},Logger.prototype.setLevel=function(e){return this.config.level=e,this},Logger.prototype.setLevelPrefixes=function(e){return this.config.useLevelPrefixes=e,this},Logger.prototype.setPrefix=function(e){"string"==typeof e&&(this.compiler.prefix=this.compiler.compile(e,!0)),"function"==typeof e&&(this.compiler.prefix=e)},Logger.prototype.unprefixed=function(e,t){var o=Array.prototype.slice.call(arguments);return this.logOne(o,t,e,!0),this},Logger.prototype.logOne=function(e,t,o,i){if(this.canLog(o))return e=e.slice(2),this.config.useLevelPrefixes&&!i&&(t=this.config.prefixes[o]+t),t=this.compiler.compile(t,i),e.unshift(t),console.log.apply(console,e),this.resetTemps(),this},Logger.prototype.resetTemps=function(){Object.keys(this._memo).forEach(function(e){this.config[e]=this._memo[e]},this)},Logger.prototype.mute=function(e){return this._mute=e,this},Logger.prototype.clone=function(e){var t=_.cloneDeep(this.config);return t="function"==typeof e?e(t)||{}:_.merge({},t,e||{}),new Logger(t)},module.exports.Logger=Logger,module.exports.compile=tfunk;