"use strict";var bufferStream=require("./buffer-stream");function getStream(e,r){if(!e)return Promise.reject(new Error("Expected a stream"));var t=(r=Object.assign({maxBuffer:1/0},r)).maxBuffer,n=void 0,u=void 0,f=new Promise(function(f,a){var o=function(e){e&&(e.bufferedData=n.getBufferedValue()),a(e)};n=bufferStream(r),e.once("error",o),e.pipe(n),n.on("data",function(){n.getBufferedLength()>t&&a(new Error("maxBuffer exceeded"))}),n.once("error",o),n.on("end",f),u=function(){e.unpipe&&e.unpipe(n)}});return f.then(u,u),f.then(function(){return n.getBufferedValue()})}module.exports=getStream,module.exports.buffer=function(e,r){return getStream(e,Object.assign({},r,{encoding:"buffer"}))},module.exports.array=function(e,r){return getStream(e,Object.assign({},r,{array:!0}))};