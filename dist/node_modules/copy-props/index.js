"use strict";var eachProps=require("each-props"),isPlainObject=require("is-plain-object");function copyWithFromto(e,t,n){if(!isPlainObject(e)){var r=n.fromto[t];if(r){delete n.fromto[t],Array.isArray(r)||(r=[r]);for(var o={keyChain:t,value:e,key:n.name,depth:n.depth,parent:n.parent},a=0,i=r.length;a<i;a++)setDeep(n.dest,r[a],function(e,t,i){var c={keyChain:r[a],value:e[t],key:t,depth:i,parent:e};return n.convert(o,c)})}}}function copyWithoutFromto(e,t,n){if(isPlainObject(e)){for(var r in e)return;setDeep(n.dest,t,newObject)}else{var o={keyChain:t,value:e,key:n.name,depth:n.depth,parent:n.parent};setDeep(n.dest,t,function(e,r,a){var i={keyChain:t,value:e[r],key:r,depth:a,parent:e};return n.convert(o,i)})}}function newObject(){return{}}function noop(e){return e.value}function onlyValueIsString(e){var t={};for(var n in e){var r=e[n];"string"==typeof r&&(t[n]=r)}return t}function arrayToObject(e){for(var t={},n=0,r=e.length;n<r;n++){var o=e[n];"string"==typeof o&&(t[o]=o)}return t}function invert(e){var t={};for(var n in e){var r=e[n];t[r]||(t[r]=[]),t[r].push(n)}return t}function setDeep(e,t,n){_setDeep(e,t.split("."),1,n)}function _setDeep(e,t,n,r){var o=t.shift();if(t.length)isPlainObject(e[o])||(e[o]={}),_setDeep(e[o],t,n+1,r);else{var a=r(e,o,n);void 0!==a&&(e[o]=a)}}function setParentEmptyObject(e,t){for(var n in t){var r=t[n];Array.isArray(r)||(r=[r]);for(var o=0,a=r.length;o<a;o++)setDeep(e,r[o],newUndefined)}}function newUndefined(){}function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}module.exports=function(e,t,n,r,o){if(isObject(e)||(e={}),isObject(t)||(t={}),isPlainObject(n)?n=onlyValueIsString(n):Array.isArray(n)?n=arrayToObject(n):"boolean"==typeof n?(o=n,r=noop,n=null):"function"==typeof n?(o=r,r=n,n=null):n=null,"function"!=typeof r&&("boolean"==typeof r?(o=r,r=noop):r=noop),"boolean"!=typeof o&&(o=!1),o){var a=e;e=t,t=a,n&&(n=invert(n))}var i={dest:t,fromto:n,convert:r};return n?(eachProps(e,copyWithFromto,i),setParentEmptyObject(t,n)):eachProps(e,copyWithoutFromto,i),t};