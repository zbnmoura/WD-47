"use strict";var reorder=require("./lib/reorder"),respawn=require("./lib/respawn"),remover=require("./lib/remover"),FORBID_RESPAWNING_FLAG="--no-respawning";module.exports=function(r,e,i,o){if(!r)throw new Error("You must specify flags to respawn with.");if(!e)throw new Error("You must specify an argv array.");"function"==typeof i&&(o=i,i=[]),"string"==typeof i&&(i=[i]),Array.isArray(i)||(i=[]);var s=e.indexOf(FORBID_RESPAWNING_FLAG);if(s>=0)return e=e.slice(0,s).concat(e.slice(s+1)),e=remover(r,e),void o(!0,process,e);var n=process,t=reorder(r,e),a=JSON.stringify(e)===JSON.stringify(t);i.length&&(t=t.slice(0,1).concat(i).concat(t.slice(1)),a=!1),a||(t.push(FORBID_RESPAWNING_FLAG),n=respawn(t)),o(a,n,t)};