"use strict";var isObject=require("isobject"),isNumber=require("is-number"),randomize=require("randomatic"),repeatStr=require("repeat-string"),repeat=require("repeat-element");function fillRange(r,t,e,n,i){if(null==r||null==t)throw new Error("fill-range expects the first and second args to be strings.");"function"==typeof e&&(i=e,n={},e=null),"function"==typeof n&&(i=n,n={}),isObject(e)&&(n=e,e="");var a,o=!1,u="",s=n||{};void 0===s.silent&&(s.silent=!0),e=e||s.step;var l=r,f=t;if(t="-0"===t.toString()?0:t,(s.optimize||s.makeRe)&&(e=e?e+="~":e,a=!0,o=!0,u="~"),"string"==typeof e){var h=stepRe().exec(e);if(h){var g=h.index,c=h[0];if("+"===c)return repeat(r,t);if("?"===c)return[randomize(r,t)];">"===c?(e=e.substr(0,g)+e.substr(g+1),a=!0):"|"===c?(e=e.substr(0,g)+e.substr(g+1),a=!0,o=!0,u=c):"~"===c&&(e=e.substr(0,g)+e.substr(g+1),a=!0,o=!0,u=c)}else if(!isNumber(e)){if(!s.silent)throw new TypeError("fill-range: invalid step.");return null}}if(/[.&*()[\]^%$#@!]/.test(r)||/[.&*()[\]^%$#@!]/.test(t)){if(!s.silent)throw new RangeError("fill-range: invalid range arguments.");return null}if(!noAlphaNum(r)||!noAlphaNum(t)||hasBoth(r)||hasBoth(t)){if(!s.silent)throw new RangeError("fill-range: invalid range arguments.");return null}var d=isNumber(zeros(r)),p=isNumber(zeros(t));if(!d&&p||d&&!p){if(!s.silent)throw new TypeError("fill-range: first range argument is incompatible with second.");return null}var m=d,v=formatStep(e);m?(r=+r,t=+t):(r=r.charCodeAt(0),t=t.charCodeAt(0));var b=r>t;(r<0||t<0)&&(a=!1,o=!1);var S,w,C=isPadded(l,f),x=[],z=0;if(o&&shouldExpand(r,t,v,m,C,s))return"|"!==u&&"~"!==u||(u=detectSeparator(r,t,v,m,b)),wrap([l,f],u,s);for(;b?r>=t:r<=t;)C&&m&&(w=C(r)),null!==(S="function"==typeof i?i(r,m,w,z++):m?formatPadding(r,w):o&&isInvalidChar(r)?null:String.fromCharCode(r))&&x.push(S),b?r-=v:r+=v;return!o&&!a||s.noexpand?x:("|"!==u&&"~"!==u||(u=detectSeparator(r,t,v,m,b)),1===x.length||r<0||t<0?x:wrap(x,u,s))}function wrap(r,t,e){"~"===t&&(t="-");var n=r.join(t),i=e&&e.regexPrefix;return"|"===t&&(n="("+(n=i?i+n:n)+")"),"-"===t&&(n="["+(n=i&&"^"===i?i+n:n)+"]"),[n]}function isCharClass(r,t,e,n,i){return!i&&(n?r<=9&&t<=9:r<t&&1===e)}function shouldExpand(r,t,e,n,i,a){return(!n||!(r>9||t>9))&&(!i&&1===e&&r<t)}function detectSeparator(r,t,e,n,i){return isCharClass(r,t,e,n,i)?"~":"|"}function formatStep(r){return Math.abs(r>>0)||1}function formatPadding(r,t){var e=t?t+r:r;return t&&"-"===r.toString().charAt(0)&&(e="-"+t+r.toString().substr(1)),e.toString()}function isInvalidChar(r){var t=toStr(r);return"\\"===t||"["===t||"]"===t||"^"===t||"("===t||")"===t||"`"===t}function toStr(r){return String.fromCharCode(r)}function stepRe(){return/\?|>|\||\+|\~/g}function noAlphaNum(r){return/[a-z0-9]/i.test(r)}function hasBoth(r){return/[a-z][0-9]|[0-9][a-z]/i.test(r)}function zeros(r){return/^-*0+$/.test(r.toString())?"0":r}function hasZeros(r){return/[^.]\.|^-*0+[0-9]/.test(r)}function isPadded(r,t){if(hasZeros(r)||hasZeros(t)){var e=length(r),n=length(t),i=e>=n?e:n;return function(r){return repeatStr("0",i-length(r))}}return!1}function length(r){return r.toString().length}module.exports=fillRange;