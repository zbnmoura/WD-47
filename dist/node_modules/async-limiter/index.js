"use strict";function Queue(t){if(!(this instanceof Queue))return new Queue(t);t=t||{},this.concurrency=t.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=done.bind(this)}var arrayAddMethods=["push","unshift","splice"];function done(){this.pending--,this._run()}arrayAddMethods.forEach(function(t){Queue.prototype[t]=function(){var n=Array.prototype[t].apply(this.jobs,arguments);return this._run(),n}}),Object.defineProperty(Queue.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),Queue.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var t=this.jobs.shift();this.pending++,t(this._done),this._run()}if(0===this.pending)for(;0!==this.cbs.length;){var n=this.cbs.pop();process.nextTick(n)}}},Queue.prototype.onDone=function(t){"function"==typeof t&&(this.cbs.push(t),this._run())},module.exports=Queue;