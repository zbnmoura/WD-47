"use strict";var crypto=require("crypto"),parse=require("url").parse,keys=["acl","location","logging","notification","partNumber","policy","requestPayment","torrent","uploadId","uploads","versionId","versioning","versions","website"];function authorization(e){return"AWS "+e.key+":"+sign(e)}function hmacSha1(e){return crypto.createHmac("sha1",e.secret).update(e.message).digest("base64")}function sign(e){return e.message=stringToSign(e),hmacSha1(e)}function signQuery(e){return e.message=queryStringToSign(e),hmacSha1(e)}function stringToSign(e){var n=e.amazonHeaders||"";return n&&(n+="\n"),[e.verb,e.md5,e.contentType,e.date?e.date.toUTCString():"",n+e.resource].join("\n")}function queryStringToSign(e){return"GET\n\n\n"+e.date+"\n"+e.resource}function canonicalizeHeaders(e){for(var n=[],r=Object.keys(e),o=0,t=r.length;o<t;++o){var i,a=e[i=r[o]];0===(i=i.toLowerCase()).indexOf("x-amz")&&n.push(i+":"+a)}return n.sort().join("\n")}function canonicalizeResource(e){var n=parse(e,!0),r=n.pathname,o=[];return Object.keys(n.query).forEach(function(e){if(~keys.indexOf(e)){var r=""==n.query[e]?"":"="+encodeURIComponent(n.query[e]);o.push(e+r)}}),r+(o.length?"?"+o.sort().join("&"):"")}module.exports=authorization,module.exports.authorization=authorization,module.exports.hmacSha1=hmacSha1,module.exports.sign=sign,module.exports.signQuery=signQuery,module.exports.stringToSign=stringToSign,module.exports.queryStringToSign=queryStringToSign,module.exports.canonicalizeHeaders=canonicalizeHeaders,module.exports.canonicalizeResource=canonicalizeResource;