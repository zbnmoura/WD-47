"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};module.exports=contentDisposition,module.exports.parse=parse;var basename=require("path").basename,ENCODE_URL_ATTR_CHAR_REGEXP=/[\x00-\x20"'()*,/:;<=>?@[\\\]{}\x7f]/g,HEX_ESCAPE_REGEXP=/%[0-9A-Fa-f]{2}/,HEX_ESCAPE_REPLACE_REGEXP=/%([0-9A-Fa-f]{2})/g,NON_LATIN1_REGEXP=/[^\x20-\x7e\xa0-\xff]/g,QESC_REGEXP=/\\([\u0000-\u007f])/g,QUOTE_REGEXP=/([\\"])/g,PARAM_REGEXP=/;[\x09\x20]*([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*=[\x09\x20]*("(?:[\x20!\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*/g,TEXT_REGEXP=/^[\x20-\x7e\x80-\xff]+$/,TOKEN_REGEXP=/^[!#$%&'*+.0-9A-Z^_`a-z|~-]+$/,EXT_VALUE_REGEXP=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+.^_`|~-])+)$/,DISPOSITION_TYPE_REGEXP=/^([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*(?:$|;)/;function contentDisposition(e,t){var r=t||{};return format(new ContentDisposition(r.type||"attachment",createparams(e,r.fallback)))}function createparams(e,t){if(void 0!==e){var r={};if("string"!=typeof e)throw new TypeError("filename must be a string");if(void 0===t&&(t=!0),"string"!=typeof t&&"boolean"!=typeof t)throw new TypeError("fallback must be a string or boolean");if("string"==typeof t&&NON_LATIN1_REGEXP.test(t))throw new TypeError("fallback must be ISO-8859-1 string");var n=basename(e),o=TEXT_REGEXP.test(n),a="string"!=typeof t?t&&getlatin1(n):basename(t),i="string"==typeof a&&a!==n;return(i||!o||HEX_ESCAPE_REGEXP.test(n))&&(r["filename*"]=n),(o||i)&&(r.filename=i?a:n),r}}function format(e){var t=e.parameters,r=e.type;if(!r||"string"!=typeof r||!TOKEN_REGEXP.test(r))throw new TypeError("invalid type");var n=String(r).toLowerCase();if(t&&"object"===(void 0===t?"undefined":_typeof(t)))for(var o,a=Object.keys(t).sort(),i=0;i<a.length;i++){n+="; "+(o=a[i])+"="+("*"===o.substr(-1)?ustring(t[o]):qstring(t[o]))}return n}function decodefield(e){var t=EXT_VALUE_REGEXP.exec(e);if(!t)throw new TypeError("invalid extended field value");var r,n=t[1].toLowerCase(),o=t[2].replace(HEX_ESCAPE_REPLACE_REGEXP,pdecode);switch(n){case"iso-8859-1":r=getlatin1(o);break;case"utf-8":r=new Buffer(o,"binary").toString("utf8");break;default:throw new TypeError("unsupported charset in extended field")}return r}function getlatin1(e){return String(e).replace(NON_LATIN1_REGEXP,"?")}function parse(e){if(!e||"string"!=typeof e)throw new TypeError("argument string is required");var t=DISPOSITION_TYPE_REGEXP.exec(e);if(!t)throw new TypeError("invalid type format");var r,n,o=t[0].length,a=t[1].toLowerCase(),i=[],E={};for(o=PARAM_REGEXP.lastIndex=";"===t[0].substr(-1)?o-1:o;t=PARAM_REGEXP.exec(e);){if(t.index!==o)throw new TypeError("invalid parameter format");if(o+=t[0].length,r=t[1].toLowerCase(),n=t[2],-1!==i.indexOf(r))throw new TypeError("invalid duplicate parameter");i.push(r),r.indexOf("*")+1!==r.length?"string"!=typeof E[r]&&('"'===n[0]&&(n=n.substr(1,n.length-2).replace(QESC_REGEXP,"$1")),E[r]=n):(r=r.slice(0,-1),n=decodefield(n),E[r]=n)}if(-1!==o&&o!==e.length)throw new TypeError("invalid parameter format");return new ContentDisposition(a,E)}function pdecode(e,t){return String.fromCharCode(parseInt(t,16))}function pencode(e){var t=String(e).charCodeAt(0).toString(16).toUpperCase();return 1===t.length?"%0"+t:"%"+t}function qstring(e){return'"'+String(e).replace(QUOTE_REGEXP,"\\$1")+'"'}function ustring(e){var t=String(e);return"UTF-8''"+encodeURIComponent(t).replace(ENCODE_URL_ATTR_CHAR_REGEXP,pencode)}function ContentDisposition(e,t){this.type=e,this.parameters=t}