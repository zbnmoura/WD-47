"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},stringWidth=require("string-width"),stripAnsi=require("strip-ansi"),wrap=require("wrap-ansi"),align={right:alignRight,center:alignCenter},top=0,right=1,bottom=2,left=3;function UI(t){this.width=t.width,this.wrap=t.wrap,this.rows=[]}function addBorder(t,n,r){return t.border?/[.']-+[.']/.test(n)?"":n.trim().length?r:"  ":""}function _minWidth(t){var n=t.padding||[],r=1+(n[left]||0)+(n[right]||0);return t.border&&(r+=4),r}function getWindowWidth(){if("object"===("undefined"==typeof process?"undefined":_typeof(process))&&process.stdout&&process.stdout.columns)return process.stdout.columns}function alignRight(t,n){t=t.trim();var r="",i=stringWidth(t);return i<n&&(r=new Array(n-i+1).join(" ")),r+t}function alignCenter(t,n){t=t.trim();var r="",i=stringWidth(t.trim());return i<n&&(r=new Array(parseInt((n-i)/2,10)+1).join(" ")),r+t}UI.prototype.span=function(){this.div.apply(this,arguments).span=!0},UI.prototype.div=function(){if(0===arguments.length&&this.div(""),this.wrap&&this._shouldApplyLayoutDSL.apply(this,arguments))return this._applyLayoutDSL(arguments[0]);for(var t,n=[],r=0;void 0!==(t=arguments[r]);r++)"string"==typeof t?n.push(this._colFromString(t)):n.push(t);return this.rows.push(n),n},UI.prototype._shouldApplyLayoutDSL=function(){return 1===arguments.length&&"string"==typeof arguments[0]&&/[\t\n]/.test(arguments[0])},UI.prototype._applyLayoutDSL=function(t){var n=this,r=t.split("\n"),i=0;return r.forEach(function(t){var r=t.split("\t");r.length>1&&stringWidth(r[0])>i&&(i=Math.min(Math.floor(.5*n.width),stringWidth(r[0])))}),r.forEach(function(t){var r=t.split("\t");n.div.apply(n,r.map(function(t,o){return{text:t.trim(),padding:n._measurePadding(t),width:0===o&&r.length>1?i:void 0}}))}),this.rows[this.rows.length-1]},UI.prototype._colFromString=function(t){return{text:t,padding:this._measurePadding(t)}},UI.prototype._measurePadding=function(t){var n=stripAnsi(t);return[0,n.match(/\s*$/)[0].length,0,n.match(/^\s*/)[0].length]},UI.prototype.toString=function(){var t=this,n=[];return t.rows.forEach(function(r,i){t.rowToString(r,n)}),(n=n.filter(function(t){return!t.hidden})).map(function(t){return t.text}).join("\n")},UI.prototype.rowToString=function(t,n){var r,i,o,e,a=this,d="";return this._rasterize(t).forEach(function(h,p){d="",h.forEach(function(h,s){i="",o=t[s].width,e=a._negatePadding(t[s]),i+=h;for(var u=0;u<e-stringWidth(h);u++)i+=" ";t[s].align&&"left"!==t[s].align&&a.wrap&&(i=align[t[s].align](i,e),stringWidth(i)<e&&(i+=new Array(o-stringWidth(i)).join(" "))),(r=t[s].padding||[0,0,0,0])[left]&&(d+=new Array(r[left]+1).join(" ")),d+=addBorder(t[s],i,"| "),d+=i,d+=addBorder(t[s],i," |"),r[right]&&(d+=new Array(r[right]+1).join(" ")),0===p&&n.length>0&&(d=a._renderInline(d,n[n.length-1]))}),n.push({text:d.replace(/ +$/,""),span:t.span})}),n},UI.prototype._renderInline=function(t,n){var r=t.match(/^ */)[0].length,i=n.text,o=stringWidth(i.trimRight());return n.span?this.wrap?r<o?t:(n.hidden=!0,i.trimRight()+new Array(r-o+1).join(" ")+t.trimLeft()):(n.hidden=!0,i+t):t},UI.prototype._rasterize=function(t){var n,r,i,o=this,e=[],a=this._columnWidths(t);return t.forEach(function(t,d){if(t.width=a[d],i=o.wrap?wrap(t.text,o._negatePadding(t),{hard:!0}).split("\n"):t.text.split("\n"),t.border&&(i.unshift("."+new Array(o._negatePadding(t)+3).join("-")+"."),i.push("'"+new Array(o._negatePadding(t)+3).join("-")+"'")),t.padding){for(n=0;n<(t.padding[top]||0);n++)i.unshift("");for(n=0;n<(t.padding[bottom]||0);n++)i.push("")}i.forEach(function(t,n){e[n]||e.push([]),r=e[n];for(var i=0;i<d;i++)void 0===r[i]&&r.push("");r.push(t)})}),e},UI.prototype._negatePadding=function(t){var n=t.width;return t.padding&&(n-=(t.padding[left]||0)+(t.padding[right]||0)),t.border&&(n-=4),n},UI.prototype._columnWidths=function(t){var n,r=this,i=[],o=t.length,e=this.width;return t.forEach(function(t,n){t.width?(o--,i[n]=t.width,e-=t.width):i[n]=void 0}),o&&(n=Math.floor(e/o)),i.forEach(function(o,e){r.wrap?void 0===o&&(i[e]=Math.max(n,_minWidth(t[e]))):i[e]=t[e].width||stringWidth(t[e].text)}),i},module.exports=function(t){return new UI({width:((t=t||{})||{}).width||getWindowWidth()||80,wrap:"boolean"!=typeof t.wrap||t.wrap})};