"use strict";try{var EventEmitter=require("events").EventEmitter}catch(t){var Emitter=require("emitter")}function noop(){}function Batch(){if(!(this instanceof Batch))return new Batch;this.fns=[],this.concurrency(1/0),this.throws(!0);for(var t=0,e=arguments.length;t<e;++t)this.push(arguments[t])}module.exports=Batch,EventEmitter?Batch.prototype.__proto__=EventEmitter.prototype:Emitter(Batch.prototype),Batch.prototype.concurrency=function(t){return this.n=t,this},Batch.prototype.push=function(t){return this.fns.push(t),this},Batch.prototype.throws=function(t){return this.e=!!t,this},Batch.prototype.end=function(t){var e,r=this,n=this.fns.length,i=n,o=[],h=[],s=(t=t||noop,this.fns),c=this.n,u=this.e,a=0;if(!s.length)return t(null,o);function p(){var c=a++,f=s[c];if(f){var v=new Date;try{f(l)}catch(t){l(t)}}function l(s,a){if(!e){if(s&&u)return e=!0,t(s);var f=n-i+1,l=new Date;o[c]=a,h[c]=s,r.emit("progress",{index:c,value:a,error:s,pending:i,total:n,complete:f,percent:f/n*100|0,start:v,end:l,duration:l-v}),--i?p():t(u?null:h,o)}}}for(var f=0;f<s.length&&f!=c;f++)p();return this};