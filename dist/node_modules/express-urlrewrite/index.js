"use strict";var debug=require("debug")("express-urlrewrite"),toRegexp=require("path-to-regexp"),URL=require("url");function rewrite(e,r){var u,t,i=[];return r?(u=toRegexp(e,i),t=toMap(i),debug("rewrite %s -> %s    %s",e,r,u)):debug("rewrite current route -> %s",e),function(i,n,a){var o,s=i.url;if(r&&!(o=u.exec(s)))return a();i.url=(r||e).replace(/\$(\d+)|(?::(\w+))/g,function(e,r,u){return u?o?o[t[u].index+1]:i.params[u]:o?o[r]:i.params[r]}),debug("rewrite %s -> %s",s,i.url),i.url.indexOf("?")>0&&(i.query=URL.parse(i.url,!0).query,debug("rewrite updated new query",i.query)),r?a():a("route")}}function toMap(e){var r={};return e.forEach(function(e,u){e.index=u,r[e.name]=e}),r}module.exports=rewrite;