"use strict";var braceRe,patternRe,expand=require("expand-range"),repeat=require("repeat-element"),tokens=require("preserve");function braces(e,t,r){if(""===e)return[];Array.isArray(t)||(r=t,t=[]);var n=r||{};t=t||[],void 0===n.nodupes&&(n.nodupes=!0);var i,s=n.fn;switch("function"==typeof n&&(s=n,n={}),patternRe instanceof RegExp||(patternRe=patternRegex()),(e.match(patternRe)||[])[0]){case"\\,":return escapeCommas(e,t,n);case"\\.":return escapeDots(e,t,n);case"/.":return escapePaths(e,t,n);case" ":return splitWhitespace(e);case"{,}":return exponential(e,n,braces);case"{}":return emptyBraces(e,t,n);case"\\{":case"\\}":return escapeBraces(e,t,n);case"${":if(!/\{[^{]+\{/.test(e))return t.concat(e);i=!0,e=tokens.before(e,es6Regex())}braceRe instanceof RegExp||(braceRe=braceRegex());var a=braceRe.exec(e);if(null==a)return[e];var c,p,o=a[1],u=a[2];if(""===u)return[e];if(-1!==u.indexOf(".."))p=(c=expand(u,n,s)||u.split(",")).length;else{if('"'===u[0]||"'"===u[0])return t.concat(e.split(/['"]/).join(""));if(c=u.split(","),n.makeRe)return braces(e.replace(o,wrap(c,"|")),n);1===(p=c.length)&&n.bash&&(c[0]=wrap(c[0],"\\"))}for(var f,l=c.length,_=0;l--;){var b=c[_++];if(/(\.[^.\/])/.test(b))return p>1?c:[e];if(f=splice(e,o,b),/\{[^{}]+?\}/.test(f))t=braces(f,t,n);else if(""!==f){if(n.nodupes&&-1!==t.indexOf(f))continue;t.push(i?tokens.after(f):f)}}return n.strict?filter(t,filterEmpty):t}function exponential(e,t,r){"function"==typeof t&&(r=t,t=null);var n,i,s=t||{},a="__ESC_EXP__",c=e.split("{,}");if(s.nodupes)return r(c.join(""),s);n=c.length-1;for(var p=(i=r(c.join(a),s)).length,o=[],u=0;p--;){var f=i[u++];if(-1===f.indexOf(a))o.push(f);else if((f=f.split("__ESC_EXP__").join(""))&&!1!==s.nodupes)o.push(f);else{var l=Math.pow(2,n);o.push.apply(o,repeat(f,l))}}return o}function wrap(e,t){return"|"===t?"("+e.join(t)+")":","===t?"{"+e.join(t)+"}":"-"===t?"["+e.join(t)+"]":"\\"===t?"\\{"+e+"\\}":void 0}function emptyBraces(e,t,r){return braces(e.split("{}").join("\\{\\}"),t,r)}function filterEmpty(e){return!!e&&"\\"!==e}function splitWhitespace(e){for(var t=e.split(" "),r=t.length,n=[],i=0;r--;)n.push.apply(n,braces(t[i++]));return n}function escapeBraces(e,t,r){return/\{[^{]+\{/.test(e)?map(braces(e=(e=e.split("\\{").join("__LT_BRACE__")).split("\\}").join("__RT_BRACE__"),t,r),function(e){return(e=e.split("__LT_BRACE__").join("{")).split("__RT_BRACE__").join("}")}):t.concat(e.split("\\").join(""))}function escapeDots(e,t,r){return/[^\\]\..+\\\./.test(e)?map(braces(e=e.split("\\.").join("__ESC_DOT__"),t,r),function(e){return e.split("__ESC_DOT__").join(".")}):t.concat(e.split("\\").join(""))}function escapePaths(e,t,r){return map(braces(e=e.split("/.").join("__ESC_PATH__"),t,r),function(e){return e.split("__ESC_PATH__").join("/.")})}function escapeCommas(e,t,r){return/\w,/.test(e)?map(braces(e=e.split("\\,").join("__ESC_COMMA__"),t,r),function(e){return e.split("__ESC_COMMA__").join(",")}):t.concat(e.split("\\").join(""))}function patternRegex(){return/\${|( (?=[{,}])|(?=[{,}]) )|{}|{,}|\\,(?=.*[{}])|\/\.(?=.*[{}])|\\\.(?={)|\\{|\\}/}function braceRegex(){return/.*(\\?\{([^}]+)\})/}function es6Regex(){return/\$\{([^}]+)\}/}function splice(e,t,r){var n=e.indexOf(t);return e.substr(0,n)+r+e.substr(n+t.length)}function map(e,t){if(null==e)return[];for(var r=e.length,n=new Array(r),i=-1;++i<r;)n[i]=t(e[i],i,e);return n}function filter(e,t){if(null==e)return[];if("function"!=typeof t)throw new TypeError("braces: filter expects a callback function.");for(var r=e.length,n=e.slice(),i=0;r--;)t(e[r],i++)||n.splice(r,1);return n}module.exports=function(e,t){if("string"!=typeof e)throw new Error("braces expects a string");return braces(e,t)};