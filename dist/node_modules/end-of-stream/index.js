"use strict";var once=require("once"),noop=function(){},isRequest=function(e){return e.setHeader&&"function"==typeof e.abort},eos=function e(n,o,r){if("function"==typeof o)return e(n,null,o);o||(o={}),r=once(r||noop);var t=n._writableState,i=n._readableState,u=o.readable||!1!==o.readable&&n.readable,a=o.writable||!1!==o.writable&&n.writable,c=function(){n.writable||l()},l=function(){a=!1,u||r()},s=function(){return(!u||i&&i.ended)&&(!a||t&&t.ended)?void 0:r(new Error("premature close"))},f=function(){n.req.on("finish",l)};return isRequest(n)?(n.on("complete",l),n.on("abort",s),n.req?f():n.on("request",f)):a&&!t&&(n.on("end",c),n.on("close",c)),n.on("end",function(){u=!1,a||r()}),n.on("finish",l),!1!==o.error&&n.on("error",r),n.on("close",s),n};module.exports=eos;